##################################################
# Application Configuration
##################################################
spring.application.name=cbs-file-generator
server.port=${SERVER_PORT:8080}                      # Default port 8080 if not set
server.servlet.context-path=/cbs-file-generator

##################################################
# JPA / Hibernate Configuration
##################################################
spring.jpa.database-platform=org.hibernate.dialect.PostgreSQLDialect
#spring.jpa.database-platform=org.hibernate.dialect.Oracle12cDialect
spring.jpa.hibernate.ddl-auto=validate
#spring.jpa.hibernate.ddl-auto=none                   # Production: do not auto-create tables
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.format_sql=false
# Fix for Oracle LOB handling in older Hibernate versions
#spring.jpa.properties.hibernate.jdbc.lob.non_contextual_creation=true

##################################################
# DataSource (Oracle) Configuration
##################################################
spring.datasource.driver-class-name=org.postgresql.Driver
#spring.datasource.driver-class-name=oracle.jdbc.OracleDriver
spring.datasource.url=jdbc:postgresql://${DB_HOST:localhost}:${DB_PORT:5432}/${DB_NAME:CBSDEVPDB}
#spring.datasource.url=jdbc:oracle:thin:@${DB_HOST:localhost}:${DB_PORT:1521}:${DB_SID:CBSDEVPDB}
spring.datasource.username=${DB_USERNAME:CBSDEV}
spring.datasource.password=${DB_PASSWORD:}
spring.datasource.type=com.zaxxer.hikari.HikariDataSource

# HikariCP Settings (Optimized)
spring.datasource.hikari.minimum-idle=${DS_MIN_IDLE:5}
spring.datasource.hikari.maximum-pool-size=${DS_MAX_POOL:50}
spring.datasource.hikari.idle-timeout=600000
spring.datasource.hikari.max-lifetime=1800000
spring.datasource.hikari.connection-timeout=30000
spring.datasource.hikari.connection-test-query=SELECT 1
#spring.datasource.hikari.connection-test-query=SELECT 1 FROM DUAL

##################################################
# Spring Batch Configuration
##################################################
spring.batch.job.enabled=false
spring.batch.initialize-schema=always
#spring.batch.initialize-schema=never                # Production: assume tables exist

##################################################
# Quartz Scheduler Configuration
##################################################
# REQUIRED: Tells Spring to use the database for Quartz
spring.quartz.job-store-type=jdbc
spring.quartz.jdbc.initialize-schema=always
#spring.quartz.jdbc.initialize-schema=never                # Production: assume tables exist

spring.quartz.properties.org.quartz.scheduler.instanceName=CBSFileGenerator
spring.quartz.properties.org.quartz.scheduler.instanceId=AUTO
spring.quartz.properties.org.quartz.threadPool.class=org.quartz.simpl.SimpleThreadPool
spring.quartz.properties.org.quartz.threadPool.threadCount=${QUARTZ_THREAD_COUNT:10}
spring.quartz.properties.org.quartz.jobStore.class=org.quartz.impl.jdbcjobstore.JobStoreTX
spring.quartz.properties.org.quartz.jobStore.driverDelegateClass=org.quartz.impl.jdbcjobstore.PostgreSQLDelegate
#spring.quartz.properties.org.quartz.jobStore.driverDelegateClass=org.quartz.impl.jdbcjobstore.oracle.OracleDelegate
spring.quartz.properties.org.quartz.jobStore.useProperties=true
spring.quartz.properties.org.quartz.jobStore.tablePrefix=QRTZ_

##################################################
#IMPORTANT : Set to true for clustered environments
##################################################
spring.quartz.properties.org.quartz.jobStore.isClustered=${QUARTZ_CLUSTERED:false}

##################################################
# Custom Async / Batch Thread Pool Settings
# (Used by your @Value annotations in AsyncConfig/BatchInfrastructureConfig)
##################################################
# Total threads (5+10) = 15. Safe for a 30-connection DB pool.
spring.task.execution.pool.core-size=5
spring.task.execution.pool.max-size=10
spring.task.execution.pool.queue-capacity=100
spring.task.execution.thread-name-prefix=async-task-

##################################################
# File Generation Logic Settings
##################################################
file.generation.output-directory=${FILE_OUTPUT_DIR:/opt/cbs/generated-files/}
#file.generation.archive-directory=${FILE_ARCHIVE_DIR:/opt/cbs/archived-files/}
#file.generation.temp-directory=${FILE_TEMP_DIR:/opt/cbs/temp-files/}
#file.generation.log-directory=${FILE_LOG_DIR:/opt/cbs/logs/}
file.generation.chunk-size=${FILE_CHUNK_SIZE:1000}
#file.generation.thread-count=${FILE_THREAD_COUNT:10}
#file.generation.max-file-size=${FILE_MAX_SIZE:100MB}
file.generation.max-file-age-in-days=${FILE_MAX_AGE_IN_DAYS:30}

##################################################
# Validation & Auth
##################################################
validation.xsd.schema-location=classpath:xsd/
validation.xsd.strict-mode=false
auth.token.header-name=${AUTH_TOKEN_HEADER:X-DB-Token}
auth.token.enable-validation=false
#auth.token.enable-validation=${AUTH_TOKEN_VALIDATION:true}
app.config.cache-refresh-interval-ms=300000

##################################################
# Logging
##################################################
logging.level.root=INFO
logging.level.com.silverlakesymmetri.cbs.fileGenerator=DEBUG
logging.pattern.console=%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level [%X{requestId}] %logger{36} - %msg%n
logging.file=${LOG_DIR:logs}/cbs-file-generator.log

##################################################
# Actuator (Refactored for Spring Boot 1.5.x)
##################################################
management.context-path=/actuator
management.security.enabled=false
endpoints.enabled=false
endpoints.health.enabled=true
endpoints.info.enabled=true
endpoints.health.sensitive=false

##################################################
# File Integrity (Used by FileFinalizationService)
##################################################
# POSIX permissions for finalized files (if on Linux)
file.generation.permissions=rw-r--r--

##################################################
# Scheduler Settings
##################################################
# Poll every 1 minute for PENDING file generation requests
batch.scheduler.cron=0 0/1 * * * ?
# Run system maintenance (CleanupTasklet) every Sunday at midnight
maintenance.scheduler.cron=0 0 0 * * SUN
# Run orders interface file generation every day at 5 am
ordersInterface.scheduler.cron=0 0 5 * * ?

spring.jackson.date-format=yyyy-MM-dd'T'HH:mm:ss.SSSZ
