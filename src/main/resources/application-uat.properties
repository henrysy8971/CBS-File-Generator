##################################################
# Application Configuration
##################################################

# Server port
# Defaults to 8080 if SERVER_PORT env variable not set
server.port=8080

# Application name
spring.application.name=cbs-file-generator

# Servlet context path
server.servlet.context-path=/cbs-file-generator

# Prevent stack traces in error responses
server.error.include-stacktrace=always

##################################################
# JPA / Hibernate Configuration
##################################################

# Hibernate dialect for Oracle 12c
spring.jpa.database-platform=org.hibernate.dialect.Oracle12cDialect

# Controls schema generation
# none        = do not automatically create or validate schema (recommended for prod)
# validate    = validate schema against entity mappings (can be used in dev/test)
# update      = update schema automatically (use with caution)
# create-drop = create schema on startup, drop on shutdown
spring.jpa.hibernate.ddl-auto=update

# Show SQL statements in logs
spring.jpa.show-sql=true

# Format SQL output
spring.jpa.properties.hibernate.format_sql=true

# Fix for Oracle LOB handling in older Hibernate versions
spring.jpa.properties.hibernate.jdbc.lob.non_contextual_creation=true

# Enable batching for large batch operations (performance optimization)
spring.jpa.properties.hibernate.jdbc.batch_size=50
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true

##################################################
# DataSource (Oracle) Configuration
##################################################

# Fully qualified Oracle JDBC driver class
# Required for connecting to Oracle databases
spring.datasource.driver-class-name=oracle.jdbc.OracleDriver

# JDBC connection URL for Oracle (SID-based)
# Uses environment variables with sensible defaults:
# - DB_HOST : database server hostname or IP
# - DB_PORT : listener port (default 1521)
# - DB_SID  : Oracle SID
spring.datasource.url=jdbc:oracle:thin:@10.253.182.53:1521:CBSEXIM

# Database username
# Can be overridden using the DB_USERNAME environment variable
spring.datasource.username=CBSDEV

# Database password
# Should be provided via environment variable in non-dev environments
spring.datasource.password=CBSDEV

# Connection pool implementation
# HikariCP is the default and recommended pool for Spring Boot
spring.datasource.type=com.zaxxer.hikari.HikariDataSource

##################################################
# HikariCP Settings (Optimized)
##################################################

# Minimum number of idle connections maintained in the pool
# Can be overridden via DS_MIN_IDLE environment variable
spring.datasource.hikari.minimum-idle=5

# Maximum number of connections in the pool
# Can be overridden via DS_MAX_POOL environment variable
# Ensure this aligns with expected concurrency (async + batch + Quartz)
spring.datasource.hikari.maximum-pool-size=50

# Maximum time (in milliseconds) a connection can stay idle before being removed
# Helps free unused connections
spring.datasource.hikari.idle-timeout=600000  # 10 minutes

# Maximum lifetime of a connection in the pool (in milliseconds)
# Connections exceeding this are retired and replaced
spring.datasource.hikari.max-lifetime=1800000  # 30 minutes

# Maximum time (in milliseconds) to wait for a connection from the pool
# Throws an exception if no connection becomes available in this time
spring.datasource.hikari.connection-timeout=30000  # 30 seconds

# SQL query used to validate connections before using them
# Simple lightweight query for Oracle
spring.datasource.hikari.connection-test-query=SELECT 1 FROM DUAL

##################################################
# Spring Batch Configuration
##################################################

# Disable automatic execution of Spring Batch jobs at application startup
# Jobs must be launched explicitly (e.g., via Quartz or a REST trigger)
spring.batch.job.enabled=false

# Controls initialization of Spring Batch database schema
# always = automatically create/drop tables on startup
# never  = assume schema already exists and is managed externally
spring.batch.initialize-schema=never

# Prefix for Spring Batch metadata tables
# Example tables: CUT_BT_JOB_INSTANCE, CUT_BT_JOB_EXECUTION, etc.
spring.batch.table-prefix=CUT_BT_

##################################################
# Quartz Scheduler Configuration
##################################################

# REQUIRED: Instructs Spring to use a JDBC-backed Quartz JobStore
# Enables persistence of jobs, triggers, and execution state
spring.quartz.job-store-type=jdbc

# Prevents Spring from automatically creating Quartz tables
# Set to 'never' when tables are managed manually or via DB scripts
spring.quartz.jdbc.initialize-schema=never

# Logical name of the Quartz scheduler instance
# Useful for identifying the scheduler in logs and clustered environments
spring.quartz.properties.org.quartz.scheduler.instanceName=CBSFileGenerator

# Automatically generates a unique instance ID
# Required for clustering and multiple scheduler instances
spring.quartz.properties.org.quartz.scheduler.instanceId=AUTO

# Thread pool implementation used by Quartz
# SimpleThreadPool is commonly used for predictable, fixed-size execution
spring.quartz.properties.org.quartz.threadPool.class=org.quartz.simpl.SimpleThreadPool

# Number of threads available for executing Quartz jobs
# Can be overridden using the QUARTZ_THREAD_COUNT environment variable
spring.quartz.properties.org.quartz.threadPool.threadCount=10

# Transactional JobStore implementation
# Ensures jobs participate in database transactions
spring.quartz.properties.org.quartz.jobStore.class=org.quartz.impl.jdbcjobstore.JobStoreTX

# Database-specific delegate for Oracle
# Handles SQL differences and locking behavior
spring.quartz.properties.org.quartz.jobStore.driverDelegateClass=org.quartz.impl.jdbcjobstore.oracle.OracleDelegate

# Store JobDataMap values as simple key/value pairs
# Improves compatibility and avoids Java serialization issues
spring.quartz.properties.org.quartz.jobStore.useProperties=true

# Prefix for Quartz database tables
# Example tables: QRTZ_JOB_DETAILS, QRTZ_TRIGGERS, etc.
spring.quartz.properties.org.quartz.jobStore.tablePrefix=QRTZ_

##################################################
#IMPORTANT : Set to true for clustered environments
##################################################
spring.quartz.properties.org.quartz.jobStore.isClustered=false
spring.quartz.properties.org.quartz.jobStore.misfireThreshold=60000  # 1 min, prevent missed triggers

##################################################
# Custom Async / Batch Thread Pool Settings
##################################################

# Core number of threads kept in the async task executor
# These threads are always kept alive, even when idle
# Tip: Increase core-size for steady background workloads
spring.task.execution.pool.core-size=5

# Maximum number of threads that can be created
# Used when the queue is full and demand increases
# Tip: Increase max-size for short bursts of heavy processing
spring.task.execution.pool.max-size=10

# Capacity of the task queue before new threads are spawned
# A larger queue favors task buffering; a smaller queue favors parallelism
# Tip: Adjust queue-capacity based on memory vs throughput needs
spring.task.execution.pool.queue-capacity=100

# Prefix used for naming async threads
# Helps identify async execution in logs and thread dumps
spring.task.execution.thread-name-prefix=async-task-

##################################################
# Jackson / JSON Configuration
##################################################
spring.jackson.date-format=yyyy-MM-dd'T'HH:mm:ss.SSSZ

##################################################
# File Generation directories
##################################################
base.dir=/u1/symmetri/products/cbs-file-generator
file.generation.external.config-dir=${base.dir}/config
file.generation.output-directory=${base.dir}/data/generated-files
file.generation.interface-config-path=${file.generation.external.config-dir}/interface-config.json

##################################################
# File Generation Logic Settings
##################################################

# Number of records processed per chunk during file generation
# Controls memory usage and processing performance
file.generation.chunk-size=1000

# Maximum age (in days) before generated files are considered expired
# Used for cleanup or archival processes
file.generation.max-file-age-in-days=30

# File system permissions applied to generated files (POSIX format)
# rw-r--r-- = owner can read/write, group and others can read
file.generation.permissions=rw-r--r--

# Maximum number of records that can be skipped during file processing
# Exceeding this count may cause the job to fail
file.generation.processor.max-skip-count=100

##################################################
# Validation & Authentication Configuration
##################################################

# Base classpath location for XSD schema files
# Used for XML validation
validation.xsd.schema-location=classpath:xsd/

# HTTP header name used to pass the authentication token
# Defaults to 'X-AUTH-TOKEN' if AUTH_TOKEN_HEADER env variable is not set
auth.token.header-name=X-AUTH-TOKEN

# Enable or disable strict XSD validation
# false = allow minor schema deviations
# true  = enforce exact XSD compliance
validation.xsd.strict-mode=false

# Enable or disable authentication token validation
# false = skip token validation (useful for local/dev environments)
auth.token.enable-validation=false

# Interval (in milliseconds) for refreshing cached application configuration
# 300000 ms = 5 minutes
app.config.cache-refresh-interval-ms=300000  # 5 minutes

##################################################
# Logging
##################################################

# Default logging level for all packages
# INFO = general application flow (startup, shutdown, key events)
logging.level.root=DEBUG

# More detailed logging for the file generator module
# DEBUG = useful for troubleshooting file generation issues
logging.level.com.silverlakesymmetri.cbs.fileGenerator=DEBUG

# Console log format:
# - Date & time
# - Thread name
# - Log level
# - requestId from MDC (if present)
# - Shortened logger name (36 chars)
# - Log message
logging.pattern.console=%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level [%X{requestId}] %logger{36} - %msg%n

# Base directory for logs (used by logback-spring.xml)
LOG_PATH=${LOG_PATH:${base.dir}/logs}

##################################################
# Actuator Configuration
##################################################

# Base path for all actuator endpoints
# Example: /actuator/health, /actuator/info
management.context-path=/actuator

# Enable (true) or disable (false) Spring Security for actuator endpoints
# Set to false to allow unauthenticated access
management.security.enabled=false

# Master switch for actuator endpoints
# false = disable ALL endpoints by default
endpoints.enabled=false

# Enable the health endpoint
# Used for application and infrastructure health checks
endpoints.health.enabled=true

# Enable the info endpoint
# Commonly used to expose build, version, or environment metadata
endpoints.info.enabled=true

# Mark the health endpoint as non-sensitive
# Non-sensitive endpoints are accessible without authentication
# Sensitive endpoints are hidden or require security
endpoints.health.sensitive=false

##################################################
# Quartz Scheduler Job Cron Expressions
##################################################

# Poll every 1 minute for PENDING file generation requests
batch.scheduler.cron=0 0/1 * * * ?

# Run system maintenance every Sunday at midnight
maintenance.scheduler.cron=0 0 0 * * SUN

# Run orders interface file generation every day at 5 am
ordersInterface.scheduler.cron=0 0 5 * * ?
